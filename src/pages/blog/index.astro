---
import type { MarkdownInstance } from "astro";
import Base from "@layouts/Base.astro";
import type { BlogPostFrontMatter } from "@types";
import { formatDate } from "../../utils.ts";

let posts = await Astro.glob<BlogPostFrontMatter>("./*.md");
type Post = MarkdownInstance<BlogPostFrontMatter>;

posts = posts.sort((a: Post, b: Post): number => {
	if (a.frontmatter.date > b.frontmatter.date) {
		return -1;
	}
	if (b.frontmatter.date > a.frontmatter.date) {
		return 1;
	}
	return 0;
});

if (import.meta.env.PROD) {
	posts = posts.filter((post) => !post.frontmatter.draft);
}
---

<Base title="My Blog Posts" , heading="My Blog Posts">
	<div>
		{
			posts.map((post) => (
				<div class="py-4 border-b first:border-t hover:bg-slate-300 rounded">
					{post.frontmatter.draft && (
						<p class="bg-red-700 text-white inline-block">DRAFT</p>
					)}
					<a class="text-blue-700 hover:underline ml-2" href={post.url}>
						{post.frontmatter.title}
					</a>
					<p class="text-right">{formatDate(post.frontmatter.date)}</p>
				</div>
			))
		}
	</div>
</Base>
